---
layout: post
title: Tri 1 Final Retrospective
permalink: /tri_1_final
toc: True
comments: True
---

### [N@TM Makeup]({{site.baseurl}}/n@tm_makeup)

### [Practice Exam 1 MCQ](https://apclassroom.collegeboard.org/8/assessments/results/71349753/performance)

#### Learning Points:

 - The colon operator - works like a for loop
    - ie. `for (int number : numberArray) {...}`

- 2D arrays (dimensional arrays)
    - Make sure your careful and understand how they are affected by for loops

- Complex programs (algorithms)
    - Make sure you can track what is happening at each point in the code snippet and test it yourself with dummy data.

```java
int first = 5 + 10 * 2;
int second = first + first % 2;
```
- Make sure that I understand how integers work and how modulus works in java. 

```java
int r = (int) (Math.random() * 6) + 10;
```

- Make sure that I understand that `Math.random()` will not include the high number (1.0), so it will never include 6.

```java
String original = "DEFGHI";
String result = /* missing code */;
System.out.println(result);
```

```java
original.substring(4) +  original.substring(0, 2) //CORRECT ANSWER
```

- Make sure that I understand how substrings work.

### Highlights from this Trimester

#### Setting up our Java Versions

> At the start of the tri, my group faced some issues setting up Java on their computers. I was able to help solve most of their issues, and in the process learned a lot about how the shell environment works.

- altering the `~/.zshrc` file and changing `JAVA_HOME`
- becoming familiar with commands like `source ~/.zshrc`
- using homebrew to install the correct openjdk version

#### Interactive lesson

> When we taught our lesson to the class, we wanted to make sure we were interactive to ensure that we caught the audiences attention and made them feel interested in the topic we were sharing.

- We employed tactics such as fun class names and cool car photos to make the audience feel more entertained while listening to our lesson
- We kept our Homework Hack simple, yet with lots of room for creativity so that students can let their minds run free and in the process, learn how to use code to implement these ideas.

#### Java file uploading API 

> Making an API in Java was super interesting since it uses classes to handle each feature. The class that constructs the JPA Repository (database entity) coupled with the class that managed the endpoints with decorators was super cool to work on!

##### HardAsset.java

```java
@Entity
public class HardAsset {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String fileName;

    private String localFileUUID;

    @Column(nullable = false)
    private String ownerUID;

    public HardAsset() {
    }

    public HardAsset(String fileName, String localFileUUID, String ownerUID) {
        this.fileName = fileName;
        this.localFileUUID = localFileUUID;
        this.ownerUID = ownerUID;
    }

    public String getOwnerUID() {
        return ownerUID;
    }

    public void setOwnerUID(String ownerUID) {
        this.ownerUID = ownerUID;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getFileName() {
        return fileName;
    }

    public void setFileName(String fileName) {
        this.fileName = fileName;
    }

    public String getLocalFileUUID() {
        return localFileUUID;
    }
}
```

- The `@Entity` decorator makes sure that the class is compiled into a table in the database.
- Saving files using a UUID makes sure there are no duplicate classes.
- Decorators on the properties like `@Id` and `@Column(nullable = false)` make sure that the schema is generated how we want it to be.

##### HardAssetController.java

```java
@RestController
@RequestMapping("/api/assets")
public class HardAssetsController {

    private static final String UPLOAD_DIR = "./uploads/";

    @Autowired
    private HardAssetsRepository repository;

    @GetMapping("/upload/{id}")
    public ResponseEntity<HardAsset> getAsset(@PathVariable Long id) {
        Optional<HardAsset> optional = repository.findById(id);
        if (optional.isPresent()) { // Good ID
            HardAsset asset = optional.get(); // value from findByID
            return new ResponseEntity<>(asset, HttpStatus.OK); // OK HTTP response: status code, headers, and body
        }
        // Bad ID
        return new ResponseEntity<>(HttpStatus.NOT_FOUND);
    }

    @GetMapping("/uploads")
    public ResponseEntity<List<HardAsset>> getUploads(@RequestParam(required = false) String uid, @AuthenticationPrincipal UserDetails userDetails) {
        String targetUid = uid;
        if (targetUid == null) {
            if (userDetails == null) {
                return new ResponseEntity<>(HttpStatus.UNAUTHORIZED);
            }
            targetUid = userDetails.getUsername();
        }
        
        List<HardAsset> assets = repository.findByOwnerUID(targetUid);
        return new ResponseEntity<>(assets, HttpStatus.OK);
    }

    @PostMapping("/upload")
    public ResponseEntity<String> postUpload(@RequestParam("file") MultipartFile file, @AuthenticationPrincipal UserDetails userDetails) {
        System.out.println("POST request for /api/upload");
        if (file.isEmpty()) {
            return new ResponseEntity<>("Please select a file to upload.", HttpStatus.BAD_REQUEST);
        }
        try {
            System.out.println("UserDetails: " + userDetails);
            String uid = userDetails.getUsername();
            System.out.println("Extracted UID: " + uid);

            // Create the upload directory if it doesn't exist
            Path uploadPath = Paths.get(UPLOAD_DIR);
            if (!Files.exists(uploadPath)) {
                Files.createDirectories(uploadPath);
            }

            String fileName = file.getOriginalFilename();
            String localFileUUID = java.util.UUID.randomUUID().toString() + "_" + fileName;
            Path filePath = Paths.get(UPLOAD_DIR + localFileUUID);
            Files.copy(file.getInputStream(), filePath);

            HardAsset newAsset = new HardAsset(fileName, localFileUUID, uid);
            repository.save(newAsset);
            System.out.println("File uploaded and saved to database: " + localFileUUID);
            return new ResponseEntity<>("Successfully uploaded and saved '" + localFileUUID + "'", HttpStatus.OK);
        } catch (IOException e) {
            return new ResponseEntity<>("Failed to upload file: " + e.getMessage(), HttpStatus.INTERNAL_SERVER_ERROR);
        } catch (Exception e) {
            return new ResponseEntity<>("Failed to upload file: " + e.getMessage(), HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
}
```

- An intersting part of using Java is the type declarations. Using these when testing my code made it really easy to find where I went wrong during the development period.
- I needed to find an effective way to test this aswell while also making sure I was authenticated, so my process ended up being like the following:
    - Make edits to the API
    - Compile and run with maven (resetting the database if I changed the schema)
    - Login to obtain an authentication token for my browser
    - Test the API using the frontend (test file upload page) (sends a multipart request)

##### SecurityConfig.java

```java
.requestMatchers(HttpMethod.POST, "/api/assets/upload").authenticated()
```

- In order to authenicate a user and make sure they are logged in, I added the path and method to the `SecurityConfig.js` file.

#### Retrospective

> As I come to the close of my 1st trimester of my senior year, I can feel the overwhelming amount of work I've had to do slowly come to an end. Juggling a job, sports, school, and college applications has made it difficult to focus on developing a super intricate app. However, this is a good learning momment for me to learn how to effectively manage a team to help me develop such a large program. In retrospect, I know that I will be able to make a much more substancial impact as I finish my college applications, however, what I've been able to focus on was more "learning java"-focused rather than "making a cool feature"-focused. Developing a simple uploading tool helped me become more acclimated to the java working environment using classes and tools like maven and JPA.

#### In Short...

- I feel like I am well on my way to learning Java
- Interacting with tools like JPA and Maven has been a good learning experience
- Initializing our Java versions has made me much more acclimated with how the computer system is operating
    - `/.zshrc` or `/.bashrc` for example or adding to the `PATH`
- I'm excited to be able to create an interesting project with my team next tri when I have more time to contribute!

